language: go
sudo: false

go:
  - "1.13"

cache:
  directories:
    - $GOPATH/pkg/mod

go_import_path: github.com/lietu/better-dns

git:
  depth: 10

env:
  - GO111MODULE=on

# Skip Travis's automagic failures in dependency resolution
install: true

script:
  # - go test -race -v -bench=. -coverprofile=coverage.txt -covermode=atomic ./...

  - GOOS=windows GOARCH=amd64 go build -o better-dns-x86_64.exe better-dns.go
  - GOOS=windows GOARCH=386   go build -o better-dns-x86.exe    better-dns.go

  - mkdir -p artifacts
  - mv better-dns-x86_64.exe artifacts
  - mv better-dns-x86.exe artifacts

deploy:

  - provider: releases
    api_key: $GITHUB_TOKEN
    edge: true
    file: artifacts/*
    skip_cleanup: true
    draft: true
    overwrite: true
    on:
      branch: master

  - provider: releases
    api_key: $GITHUB_TOKEN
    edge: true
    file: artifacts/*
    skip_cleanup: true
    on:
      tags: true
